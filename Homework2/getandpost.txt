from http.server import HTTPServer, BaseHTTPRequestHandler
import cgi


artist = ''


def request_to_api(artist):
    pass


class Server(BaseHTTPRequestHandler):

    def do_GET(self):
        if self.path == '/':
            self.path = '/select'

        print(artist)

        try:
            if self.path.endswith('/select'):
                file_to_open = open('index.html').read()
            elif self.path.endswith('/result'):
                file_to_open = open('index.html').read()
            self.send_response(200)

        except FileNotFoundError:
            file_to_open = 'File not found!'
            self.send_response(404)
        self.end_headers()
        self.wfile.write(bytes(file_to_open, 'utf-8'))


    def do_POST(self):
        if self.path.endswith('/result'):
            ctype, pdict = cgi.parse_header(self.headers.get('content-type'))
            if ctype == 'multipart/form-data':
                pdict['boundary'] = bytes(pdict['boundary'], 'utf-8')
                content_len = int(self.headers.get('Content-Length'))
                pdict['CONTENT-LENGTH'] = content_len
                fields = cgi.parse_multipart(self.rfile, pdict)
                global artist
                artist = fields.get('artist')[0]
        self.send_response(301)
        self.send_header('content-type', 'text/html')
        self.send_header('Location', '/result')
        self.end_headers()


server = HTTPServer(('localhost', 9000), Server)
server.serve_forever()
